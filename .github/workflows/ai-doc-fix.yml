name: AI Documentation Fixer

on:
  push:
    branches:
      - main

jobs:
  auto_fix_docs:
    if: ${{ !contains(github.event.head_commit.message, '[AI fix]') }}
    runs-on: ubuntu-latest
    permissions:
      contents: write
    concurrency:
      group: ai-doc-fix-${{ github.ref }}
      cancel-in-progress: true
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 2
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install Python dependencies
        run: pip install --no-cache-dir openai tiktoken
      - name: Run AI documentation fixer
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: python .github/scripts/ai_doc_fix.py
